<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Keranjang Saya | Carita Hidroponik</title>

    <!-- ========== STYLE ========== -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/my cart.css" />
    <link rel="stylesheet" href="css/mobile.css" media="(max-width: 768px)" />

    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
  </head>

  <body x-data @alpine:init="
    $store.products.init();
    $store.cart.init();
  ">
    <div id="header-include"></div>

    <main class="main-content">
      <section class="cart-section">
        <div class="container">
          <h2 class="section-title">Keranjang Belanja</h2>
          <div class="cart-layout" x-data>
            <!-- CART ITEMS -->
            <div class="cart-items-container">
              <div class="cart-header">
                <div class="header-product">Produk</div>
                <div class="header-quantity">Kuantitas</div>
                <div class="header-total">Total</div>
              </div>

              <div id="cart-items-list">
                <template x-if="$store.cart.items.length === 0">
                  <p class="cart-empty-message">Keranjang belanja Anda kosong.</p>
                </template>

                <template x-for="item in $store.cart.details" :key="item.id" x-init="$nextTick(() => feather.replace())">
                  <div class="cart-item">
                    <div class="cart-item-product">
                      <img :src="item.img" :alt="item.name" class="cart-item-image" />
                      <div class="cart-item-details">
                        <h4 class="item-name" x-text="item.name"></h4>
                        <div class="item-price" x-text="`Rp ${item.price.toLocaleString('id-ID')}`"></div>
                      </div>
                    </div>
                    <div class="cart-item-quantity">
                      <button class="quantity-btn" @click="$store.cart.remove(item.id)" aria-label="Kurangi">-</button>
                      <span class="quantity-value" x-text="item.quantity"></span>
                      <button class="quantity-btn" @click="$store.cart.add(item.id)" aria-label="Tambah">+</button>
                    </div>
                    <div class="cart-item-total" x-text="`Rp ${item.subtotal.toLocaleString('id-ID')}`"></div>
                    <button class="cart-item-remove" @click="$store.cart.remove(item.id, true)" aria-label="Hapus item">
                      <i data-feather="trash-2"></i>
                    </button>
                  </div>
                </template>
              </div>

              <a href="index.html#Product" class="continue-shopping">
                <i data-feather="arrow-left"></i> Lanjut Belanja
              </a>
            </div>

            <!-- SUMMARY -->
            <div class="cart-summary">
              <h3>Ringkasan Belanja</h3>

              <div class="coupon-form">
                <input type="text" placeholder="Masukkan Kode Kupon" />
                <button class="btn btn-secondary">Terapkan</button>
              </div>

              <div class="summary-item">
                <span>Subtotal</span>
                <span id="summary-subtotal" x-text="`Rp ${$store.cart.total.toLocaleString('id-ID')}`"></span>
              </div>
              <div class="summary-item">
                <span>Ongkos Kirim</span>
                <span id="summary-shipping">Rp 0</span>
              </div>

              <div class="summary-total">
                <span>Total</span>
                <span id="summary-total" x-text="`Rp ${$store.cart.total.toLocaleString('id-ID')}`"></span>
              </div>

              <button
                id="checkout-btn"
                class="btn btn-primary btn-block"
                :disabled="$store.cart.items.length === 0"
              >
                Checkout Sekarang
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- ========== NOTIFICATION MODAL ========== -->
      <div id="profile-incomplete-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
          <h3 class="modal-title">Profil Belum Lengkap</h3>
          <p class="modal-body">
            Untuk melanjutkan checkout, Anda harus melengkapi data profil Anda terlebih dahulu.
          </p>
          <div class="modal-actions">
            <button id="close-modal-btn" class="btn btn-secondary">Nanti Saja</button>
            <a href="my account.html" class="btn btn-primary">Lengkapi Profil</a>
          </div>
        </div>
      </div>

      <div id="notification" class="notification"></div>

      <div id="login-required-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
          <h3 class="modal-title">Anda Belum Login</h3>
          <p class="modal-body">
            Silakan login atau buat akun terlebih dahulu untuk melanjutkan proses checkout.
          </p>
          <div class="modal-actions">
            <button id="close-login-modal-btn" class="btn btn-secondary">Tutup</button>
            <a href="login page.html" class="btn btn-primary">Login atau Daftar</a>
          </div>
        </div>
      </div>

      <div id="confirmation-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
          <h3 class="modal-title">Konfirmasi Pesanan Anda</h3>
          <div id="confirmation-summary" class="confirmation-summary">
            <!-- Order summary will be injected here by JavaScript -->
          </div>
          <div class="modal-actions">
            <button id="cancel-order-btn" class="btn btn-secondary">Batal</button>
            <button id="confirm-order-btn" class="btn btn-primary">Konfirmasi & Pesan</button>
          </div>
        </div>
      </div>
    </main>

    <div id="footer-include"></div>

    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.10/dist/cdn.min.js?nounit=true" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="js/supabase-client.js" defer></script>
    <script src="js/main.js" defer></script>
    <script src="js/include.js" defer></script>
    <script src="js/script.js" defer></script>
    <script src="js/checkout.js" defer></script>
  </body>
</html>
